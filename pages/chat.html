<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… - ì»¤í”¼CMD</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/terminal.css">
    <style>
        /* ì±„íŒ… í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .chat-container {
            height: calc(100% - 90px);
            display: flex;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .chat-list {
            width: 220px;
            border-right: 1px solid #0f0;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .chat-preview {
            padding: 8px;
            margin-bottom: 5px;
            border: 1px solid #333;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .chat-preview:hover, .chat-preview.active {
            background-color: #031;
            border-color: #0f0;
        }
        
        .chat-preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .chat-preview-name {
            color: yellow;
            font-weight: bold;
        }
        
        .chat-preview-time {
            color: #999;
            font-size: 11px;
        }
        
        .chat-preview-message {
            color: #ccc;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-preview-notification {
            background-color: #0f0;
            color: #000;
            border-radius: 50%;
            padding: 0 6px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .chat-content {
            flex: 1;
            padding-left: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #555;
        }
        
        .chat-empty-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .emoticon-panel {
            border: 1px solid #0f0;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .emoticon-item {
            text-align: center;
            padding: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .emoticon-item:hover {
            background-color: #031;
        }
        
        .chat-message {
            padding: 5px 10px;
            margin-bottom: 8px;
            max-width: 80%;
            border-radius: 5px;
            position: relative;
        }
        
        .chat-message-sent {
            align-self: flex-end;
            background-color: #063;
            color: #fff;
        }
        
        .chat-message-received {
            align-self: flex-start;
            background-color: #333;
            color: #fff;
        }
        
        .chat-message-time {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
            text-align: right;
        }
        
        .chat-date-divider {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin: 10px 0;
            position: relative;
        }
        
        .chat-date-divider::before,
        .chat-date-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background-color: #333;
        }
        
        .chat-date-divider::before {
            left: 0;
        }
        
        .chat-date-divider::after {
            right: 0;
        }
        
        .chat-info-message {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin: 10px 0;
            font-style: italic;
        }
        
        .chat-tools-panel {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="terminal-screen">
        <div class="message system-message">ì±„íŒ… í™”ë©´ì…ë‹ˆë‹¤. ì™¼ìª½ì˜ ì±„íŒ… ëª©ë¡ì—ì„œ ëŒ€í™” ìƒëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
        
        <div class="chat-container">
            <div class="chat-list" id="chatList">
                <div class="chat-preview active" data-id="user2">
                    <div class="chat-preview-header">
                        <span class="chat-preview-name">ê¹€ê°œë°œ</span>
                        <span class="chat-preview-time">1ì‹œê°„ ì „</span>
                    </div>
                    <div class="chat-preview-message">ê°•ë‚¨ì—­ ê·¼ì²˜ì—ì„œ ì»¤í”¼ í•œì” í•˜ë©´ì„œ ë” ìì„¸íˆ ì—¬ì­¤ë³´ê³  ì‹¶ë„¤ìš” ã…ã…</div>
                </div>
                
                <div class="chat-preview" data-id="user1">
                    <div class="chat-preview-header">
                        <span class="chat-preview-name">ë°•ë””ìì´ë„ˆ</span>
                        <span class="chat-preview-time">3ì‹œê°„ ì „</span>
                    </div>
                    <div class="chat-preview-message">í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì—…ì— ëŒ€í•´ ì¡°ì–¸ ë¶€íƒë“œë ¤ìš”!</div>
                    <span class="chat-preview-notification">2</span>
                </div>
                
                <div class="chat-preview" data-id="user4">
                    <div class="chat-preview-header">
                        <span class="chat-preview-name">ìµœë§ˆì¼€í„°</span>
                        <span class="chat-preview-time">ì–´ì œ</span>
                    </div>
                    <div class="chat-preview-message">SNS ê´‘ê³  ì „ëµì— ëŒ€í•´ ì´ì•¼ê¸° ë‚˜ëˆ ë´ìš”</div>
                </div>
                
                <div class="chat-preview" data-id="user5">
                    <div class="chat-preview-header">
                        <span class="chat-preview-name">ì •UX</span>
                        <span class="chat-preview-time">2ì¼ ì „</span>
                    </div>
                    <div class="chat-preview-message">ë‹¤ìŒ ì£¼ í™”ìš”ì¼ ì¼ì • í™•ì¸ ë¶€íƒë“œë ¤ìš”</div>
                </div>
                
                <div class="chat-preview" data-id="user6">
                    <div class="chat-preview-header">
                        <span class="chat-preview-name">ë°•í’€ìŠ¤íƒ</span>
                        <span class="chat-preview-time">1ì£¼ì¼ ì „</span>
                    </div>
                    <div class="chat-preview-message">ì§€ë‚œë²ˆ ë¯¸íŒ… ê°ì‚¬í–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”</div>
                </div>
            </div>
            
            <div class="chat-content" id="chatContent">
                <div class="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-avatar">ê¹€</div>
                        <div>
                            <div class="chat-name">ê¹€ê°œë°œ</div>
                            <div class="chat-status">í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì</div>
                        </div>
                    </div>
                    <div class="chat-tools">
                        <button class="chat-tool-button" id="scheduleBtn">ì¼ì • ì¡ê¸°</button>
                        <button class="chat-tool-button" id="profileBtn">í”„ë¡œí•„ ë³´ê¸°</button>
                    </div>
                </div>
                
                <div class="chat-tools-panel">
                    <button class="chat-tool-button" id="refreshBtn">ìƒˆë¡œê³ ì¹¨</button>
                    <button class="chat-tool-button" id="saveBtn">ëŒ€í™” ì €ì¥</button>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-date-divider">2025ë…„ 2ì›” 28ì¼</div>
                    
                    <div class="chat-message chat-message-received">
                        <div class="chat-message-content">ì•ˆë…•í•˜ì„¸ìš”! í”„ë¡œí•„ ë³´ê³  ì—°ë½ë“œë¦½ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ê´€ë ¨í•´ì„œ ì´ì•¼ê¸° ë‚˜ëˆ ë³´ê³  ì‹¶ì–´ìš”~</div>
                        <div class="chat-message-time">ì˜¤ì „ 10:15</div>
                    </div>
                    
                    <div class="chat-message chat-message-sent">
                        <div class="chat-message-content">ì•ˆë…•í•˜ì„¸ìš”! ë°˜ê°‘ìŠµë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì–´ë–¤ ë¶€ë¶„ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?</div>
                        <div class="chat-message-time">ì˜¤ì „ 10:22</div>
                    </div>
                    
                    <div class="chat-message chat-message-received">
                        <div class="chat-message-content">ìš”ì¦˜ React 18ì—ì„œ Suspense í™œìš©ì´ë‚˜ ì„œë²„ ì»´í¬ë„ŒíŠ¸ ê´€ë ¨í•´ì„œ ê³ ë¯¼ì´ ë§ì•„ì„œìš”. í˜¹ì‹œ ì´ ë¶€ë¶„ ê²½í—˜ì´ ìˆìœ¼ì‹ ì§€ìš”?</div>
                        <div class="chat-message-time">ì˜¤ì „ 10:30</div>
                    </div>
                    
                    <div class="chat-message chat-message-sent">
                        <div class="chat-message-content">ë„¤, ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” ìµœê·¼ í”„ë¡œì íŠ¸ì—ì„œ ë„ì…í•´ë´¤ì–´ìš”. ìƒê°ë³´ë‹¤ ì´ˆê¸° ì„¤ì •ì´ ê¹Œë‹¤ë¡œì› ì§€ë§Œ ë°ì´í„° íŒ¨ì¹­ íŒ¨í„´ì´ ë§ì´ ê¹”ë”í•´ì¡Œì–´ìš”.</div>
                        <div class="chat-message-time">ì˜¤ì „ 10:35</div>
                    </div>
                    
                    <div class="chat-message chat-message-received">
                        <div class="chat-message-content">ì˜¤ ê·¸ë ‡êµ°ìš”! í˜¹ì‹œ ë‹¤ìŒ ì£¼ í™”ìš”ì¼ ì˜¤í›„ì— ì‹œê°„ ë˜ì‹œë‚˜ìš”? ê°•ë‚¨ì—­ ê·¼ì²˜ì—ì„œ ì»¤í”¼ í•œì” í•˜ë©´ì„œ ë” ìì„¸íˆ ì—¬ì­¤ë³´ê³  ì‹¶ë„¤ìš” ã…ã…</div>
                        <div class="chat-message-time">ì˜¤ì „ 11:05</div>
                    </div>
                </div>
                
                <div id="emoticonPanel" class="emoticon-panel hidden">
                    <div class="emoticon-item">ã…‹ã…‹ã…‹</div>
                    <div class="emoticon-item">ã…ã…ã…</div>
                    <div class="emoticon-item">ã… ã… </div>
                    <div class="emoticon-item">^^</div>
                    <div class="emoticon-item">^_^</div>
                    <div class="emoticon-item">:)</div>
                    <div class="emoticon-item">:D</div>
                    <div class="emoticon-item">ã„·ã„·</div>
                    <div class="emoticon-item">â™¡</div>
                    <div class="emoticon-item">â˜…</div>
                    <div class="emoticon-item">( â€¢Ì€ Ï‰ â€¢Ì )âœ§</div>
                    <div class="emoticon-item">(ï¿£â–½ï¿£)V</div>
                    <div class="emoticon-item">(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»</div>
                    <div class="emoticon-item">â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)</div>
                    <div class="emoticon-item">Â¯\_(ãƒ„)_/Â¯</div>
                </div>
                
                <div class="input-line">
                    <span class="prompt">ë©”ì‹œì§€></span>
                    <input type="text" class="command-input" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                    <button class="command-button" id="emoticonBtn">ì´ëª¨í‹°ì½˜</button>
                    <button class="command-button" id="sendBtn">ì „ì†¡</button>
                </div>
            </div>
            
            <!-- ì±„íŒ… ë¹„ì–´ìˆì„ ë•Œ í‘œì‹œí•  í™”ë©´ -->
            <div class="chat-empty hidden" id="chatEmpty">
                <div class="chat-empty-icon">[._.]</div>
                <div class="chat-empty-text">ì™¼ìª½ì—ì„œ ëŒ€í™”í•  ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatList = document.getElementById('chatList');
            const chatContent = document.getElementById('chatContent');
            const chatEmpty = document.getElementById('chatEmpty');
            const chatMessages = document.getElementById('chatMessages');
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const emoticonBtn = document.getElementById('emoticonBtn');
            const emoticonPanel = document.getElementById('emoticonPanel');
            const scheduleBtn = document.getElementById('scheduleBtn');
            const profileBtn = document.getElementById('profileBtn');
            const refreshBtn = document.getElementById('refreshBtn');
            const saveBtn = document.getElementById('saveBtn');
            
            // í˜„ì¬ ì„ íƒëœ ì±„íŒ… ID
            let currentChatId = 'user2';
            
            // Mock ë°ì´í„°
            const users = {
                'user1': { name: 'ë°•ë””ìì´ë„ˆ', job: 'UX/UI ë””ìì´ë„ˆ', lastSeen: 'ë°©ê¸ˆ ì „', unread: 2 },
                'user2': { name: 'ê¹€ê°œë°œ', job: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì', lastSeen: '1ì‹œê°„ ì „', unread: 0 },
                'user4': { name: 'ìµœë§ˆì¼€í„°', job: 'ë””ì§€í„¸ ë§ˆì¼€í„°', lastSeen: 'ì–´ì œ', unread: 0 },
                'user5': { name: 'ì •UX', job: 'UX ë¦¬ì„œì²˜', lastSeen: '2ì¼ ì „', unread: 0 },
                'user6': { name: 'ë°•í’€ìŠ¤íƒ', job: 'í’€ìŠ¤íƒ ê°œë°œì', lastSeen: '1ì£¼ì¼ ì „', unread: 0 }
            };
            
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ í˜„ì¬ ì±„íŒ… ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°
            const storedUser = sessionStorage.getItem('currentChatUser');
            if (storedUser) {
                const userData = JSON.parse(storedUser);
                currentChatId = userData.id;
                
                // ì±„íŒ… ëª©ë¡ì—ì„œ í•´ë‹¹ ì‚¬ìš©ì í™œì„±í™”
                const chatItems = document.querySelectorAll('.chat-preview');
                chatItems.forEach(item => item.classList.remove('active'));
                
                const targetChat = document.querySelector(`.chat-preview[data-id="${currentChatId}"]`);
                if (targetChat) {
                    targetChat.classList.add('active');
                }
                
                // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ í´ë¦¬ì–´
                sessionStorage.removeItem('currentChatUser');
            }
            
            // ì±„íŒ… ëª©ë¡ í´ë¦­ ì²˜ë¦¬
            setupChatListClicks();
            
            // ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬
            setupMessageSending();
            
            // ì´ëª¨í‹°ì½˜ íŒ¨ë„ ì²˜ë¦¬
            setupEmoticonPanel();
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
            setupButtonActions();
            
            // ì±„íŒ… ëª©ë¡ í´ë¦­ ì²˜ë¦¬
            function setupChatListClicks() {
                const chatItems = document.querySelectorAll('.chat-preview');
                
                chatItems.forEach(item => {
                    item.addEventListener('click', function() {
                        // í™œì„± ì±„íŒ… ë³€ê²½
                        chatItems.forEach(chat => chat.classList.remove('active'));
                        this.classList.add('active');
                        
                        // í˜„ì¬ ì±„íŒ… ID ì—…ë°ì´íŠ¸
                        currentChatId = this.getAttribute('data-id');
                        
                        // ì±„íŒ… ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
                        loadChatContent(currentChatId);
                        
                        // ì•Œë¦¼ ì œê±°
                        const notification = this.querySelector('.chat-preview-notification');
                        if (notification) {
                            notification.remove();
                        }
                    });
                });
            }
            
            // ì±„íŒ… ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
            function loadChatContent(userId) {
                if (!users[userId]) {
                    showChatEmpty();
                    return;
                }
                
                // ì±„íŒ… UI í‘œì‹œ
                chatContent.classList.remove('hidden');
                chatEmpty.classList.add('hidden');
                
                // í—¤ë” ì—…ë°ì´íŠ¸
                const user = users[userId];
                document.querySelector('.chat-avatar').textContent = user.name.charAt(0);
                document.querySelector('.chat-name').textContent = user.name;
                document.querySelector('.chat-status').textContent = user.job;
                
                // ì¶”ê°€ ì±„íŒ… ë©”ì‹œì§€ ë¡œë”© (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œ)
                // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ì‹œë®¬ë ˆì´ì…˜ë§Œ êµ¬í˜„
                
                // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                scrollToBottom();
            }
            
            // ë¹ˆ ì±„íŒ… í‘œì‹œ
            function showChatEmpty() {
                chatContent.classList.add('hidden');
                chatEmpty.classList.remove('hidden');
            }
            
            // ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬
            function setupMessageSending() {
                messageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                
                sendBtn.addEventListener('click', sendMessage);
            }
            
            // ë©”ì‹œì§€ ì „ì†¡
            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                // ìƒˆ ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message chat-message-sent';
                
                const contentElement = document.createElement('div');
                contentElement.className = 'chat-message-content';
                contentElement.textContent = message;
                
                const timeElement = document.createElement('div');
                timeElement.className = 'chat-message-time';
                
                // í˜„ì¬ ì‹œê°„ í¬ë§·íŒ… (ì˜¤ì „/ì˜¤í›„ HH:MM)
                const now = new Date();
                const ampm = now.getHours() < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
                const hours = now.getHours() % 12 || 12;
                const minutes = now.getMinutes().toString().padStart(2, '0');
                timeElement.textContent = `${ampm} ${hours}:${minutes}`;
                
                messageElement.appendChild(contentElement);
                messageElement.appendChild(timeElement);
                
                // ì±„íŒ… ì°½ì— ì¶”ê°€
                chatMessages.appendChild(messageElement);
                
                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                messageInput.value = '';
                
                // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                scrollToBottom();
                
                // ìë™ ì‘ë‹µ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬)
                setTimeout(() => {
                    // ê°„ë‹¨í•œ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
                    const responses = [
                        "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤!",
                        "ì¢‹ì€ ì˜ê²¬ì´ë„¤ìš”. ë” ìì„¸íˆ ë§ì”€í•´ ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
                        "í¥ë¯¸ë¡œìš´ ì£¼ì œì˜ˆìš”. ë‹¤ìŒ ë¯¸íŒ…ì—ì„œ ë” ë…¼ì˜í•´ë´ìš”!",
                        "ê·¸ë ‡êµ°ìš”. ì´ ë¶€ë¶„ì€ ì œê°€ ë” ê³ ë¯¼í•´ë´ì•¼ê² ë„¤ìš”.",
                        "ì¢‹ì€ ì •ë³´ ê°ì‚¬í•©ë‹ˆë‹¤! ì°¸ê³ í• ê²Œìš”.",
                        "ë‹¹ì—°í•˜ì£ ! ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ì£¼ì„¸ìš”.",
                        "ê·¸ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ì œê°€ ê²½í—˜ì´ ë§ì§€ ì•Šì•„ìš”. í˜¹ì‹œ ì¶”ì²œí•´ì£¼ì‹¤ ë§Œí•œ ìë£Œê°€ ìˆì„ê¹Œìš”?",
                        "ë‹¤ìŒ ì£¼ì— ë§Œë‚˜ì„œ ë” ì´ì•¼ê¸°í•´ë³´ë©´ ì¢‹ê² ë„¤ìš”!",
                        "í™•ì‹¤íˆ ì´í•´í–ˆìŠµë‹ˆë‹¤. ê²€í†  í›„ ë‹¤ì‹œ ì—°ë½ë“œë¦´ê²Œìš”.",
                        "ë„¤, ê°€ëŠ¥í•©ë‹ˆë‹¤! ì¼ì • ì¡ì•„ë³¼ê¹Œìš”?"
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    const responseElement = document.createElement('div');
                    responseElement.className = 'chat-message chat-message-received';
                    
                    const responseContent = document.createElement('div');
                    responseContent.className = 'chat-message-content';
                    responseContent.textContent = randomResponse;
                    
                    const responseTime = document.createElement('div');
                    responseTime.responseTime.className = 'chat-message-time';
                    
                    // ì•½ê°„ ì§€ì—°ëœ ì‹œê°„ (1~2ë¶„ í›„)
                    const responseDate = new Date(now.getTime() + Math.floor(Math.random() * 120000));
                    const responseAmPm = responseDate.getHours() < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
                    const responseHours = responseDate.getHours() % 12 || 12;
                    const responseMinutes = responseDate.getMinutes().toString().padStart(2, '0');
                    responseTime.textContent = `${responseAmPm} ${responseHours}:${responseMinutes}`;
                    
                    responseElement.appendChild(responseContent);
                    responseElement.appendChild(responseTime);
                    
                    chatMessages.appendChild(responseElement);
                    
                    // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                    scrollToBottom();
                    
                    // ì±„íŒ… ëª©ë¡ ì—…ë°ì´íŠ¸
                    updateChatPreview(currentChatId, randomResponse);
                    
                }, Math.random() * 2000 + 1000); // 1-3ì´ˆ ì‚¬ì´ ëœë¤ ì§€ì—°
            }
            
            // ì±„íŒ… ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // ì±„íŒ… ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            function updateChatPreview(userId, lastMessage) {
                const chatPreview = document.querySelector(`.chat-preview[data-id="${userId}"]`);
                if (chatPreview) {
                    // ë©”ì‹œì§€ ë‚´ìš© ì—…ë°ì´íŠ¸
                    const messagePreview = chatPreview.querySelector('.chat-preview-message');
                    messagePreview.textContent = lastMessage;
                    
                    // ì‹œê°„ ì—…ë°ì´íŠ¸
                    const timePreview = chatPreview.querySelector('.chat-preview-time');
                    timePreview.textContent = 'ë°©ê¸ˆ ì „';
                    
                    // ë§¨ ìœ„ë¡œ ì´ë™ (ìµœì‹  ëŒ€í™” ìˆœ)
                    const chatListContainer = document.getElementById('chatList');
                    chatListContainer.insertBefore(chatPreview, chatListContainer.firstChild);
                }
            }
            
            // ì´ëª¨í‹°ì½˜ íŒ¨ë„ ì„¤ì •
            function setupEmoticonPanel() {
                emoticonBtn.addEventListener('click', function() {
                    emoticonPanel.classList.toggle('hidden');
                });
                
                // ì´ëª¨í‹°ì½˜ ì„ íƒ ì²˜ë¦¬
                const emoticons = document.querySelectorAll('.emoticon-item');
                emoticons.forEach(emoticon => {
                    emoticon.addEventListener('click', function() {
                        messageInput.value += this.textContent;
                        messageInput.focus();
                        emoticonPanel.classList.add('hidden');
                    });
                });
                
                // íŒ¨ë„ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                document.addEventListener('click', function(e) {
                    if (!emoticonPanel.contains(e.target) && e.target !== emoticonBtn) {
                        emoticonPanel.classList.add('hidden');
                    }
                });
            }
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
            function setupButtonActions() {
                // ì¼ì • ì¡ê¸° ë²„íŠ¼
                scheduleBtn.addEventListener('click', function() {
                    const user = users[currentChatId];
                    
                    const scheduleContent = `
                        <div class="form-group">
                            <label class="form-label">ë‚ ì§œ</label>
                            <input type="date" class="form-input" id="scheduleDate" min="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì‹œê°„</label>
                            <input type="time" class="form-input" id="scheduleTime">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì¥ì†Œ</label>
                            <select class="form-select" id="scheduleLocation">
                                <option value="ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì ">ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì </option>
                                <option value="ì¹´í˜ ê³µëª…">ì¹´í˜ ê³µëª…</option>
                                <option value="ì¹´í˜ ë…¸ë§ˆë“œ">ì¹´í˜ ë…¸ë§ˆë“œ</option>
                                <option value="ë¸”ë£¨ë³´í‹€ ì„±ìˆ˜ì ">ë¸”ë£¨ë³´í‹€ ì„±ìˆ˜ì </option>
                                <option value="ì§ì ‘ ì…ë ¥">ì§ì ‘ ì…ë ¥</option>
                            </select>
                        </div>
                        <div class="form-group" id="customLocationGroup" style="display: none;">
                            <label class="form-label">ì§ì ‘ ì…ë ¥</label>
                            <input type="text" class="form-input" id="customLocation">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë©”ëª¨</label>
                            <textarea class="form-textarea" id="scheduleMemo" placeholder="ë©”ëª¨ ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                        </div>
                    `;
                    
                    window.parent.postMessage({
                        action: 'openModal',
                        title: `${user.name}ë‹˜ê³¼ ì¼ì • ì¡ê¸°`,
                        content: scheduleContent,
                        buttons: [
                            {
                                text: 'ì „ì†¡',
                                action: function() {
                                    const date = document.getElementById('scheduleDate').value;
                                    const time = document.getElementById('scheduleTime').value;
                                    
                                    if (!date || !time) {
                                        alert('ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                                        return false;
                                    }
                                    
                                    const locationSelect = document.getElementById('scheduleLocation');
                                    let location = locationSelect.value;
                                    
                                    if (location === 'ì§ì ‘ ì…ë ¥') {
                                        location = document.getElementById('customLocation').value;
                                        if (!location) {
                                            alert('ì¥ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                                            return false;
                                        }
                                    }
                                    
                                    const memo = document.getElementById('scheduleMemo').value;
                                    
                                    // ì¼ì • ë©”ì‹œì§€ ì „ì†¡
                                    sendScheduleMessage(date, time, location, memo);
                                    
                                    // ê²½í—˜ì¹˜ íšë“
                                    window.parent.postMessage({
                                        action: 'updateUser',
                                        userData: {
                                            exp: 30,
                                            points: 10
                                        }
                                    }, '*');
                                    
                                    window.parent.postMessage({
                                        action: 'notification',
                                        text: `${user.name}ë‹˜ê³¼ì˜ ì¼ì •ì´ ì œì•ˆë˜ì—ˆìŠµë‹ˆë‹¤.`,
                                        type: 'success'
                                    }, '*');
                                }
                            },
                            {
                                text: 'ì·¨ì†Œ',
                                type: 'cancel'
                            }
                        ]
                    }, '*');
                    
                    // ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ ì¶”ê°€ í•„ë“œ í‘œì‹œ
                    setTimeout(() => {
                        const locationSelect = document.getElementById('scheduleLocation');
                        const customLocationGroup = document.getElementById('customLocationGroup');
                        
                        locationSelect.addEventListener('change', function() {
                            if (this.value === 'ì§ì ‘ ì…ë ¥') {
                                customLocationGroup.style.display = 'block';
                            } else {
                                customLocationGroup.style.display = 'none';
                            }
                        });
                    }, 100);
                });
                
                // í”„ë¡œí•„ ë³´ê¸° ë²„íŠ¼
                profileBtn.addEventListener('click', function() {
                    const user = users[currentChatId];
                    
                    window.parent.postMessage({
                        action: 'notification',
                        text: `${user.name}ë‹˜ì˜ í”„ë¡œí•„ë¡œ ì´ë™í•©ë‹ˆë‹¤.`,
                        type: 'info'
                    }, '*');
                    
                    // ì„ì‹œë¡œ í”„ë¡œí•„ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
                    const profileContent = `
                        <div class="profile-info">
                            <div class="profile-item">
                                <div class="profile-label">ì´ë¦„:</div>
                                <div class="profile-value">${user.name}</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">ì§ì—…:</div>
                                <div class="profile-value">${user.job}</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">ë§ˆì§€ë§‰ ì ‘ì†:</div>
                                <div class="profile-value">${user.lastSeen}</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">ê´€ì‹¬ ë¶„ì•¼:</div>
                                <div class="profile-value">
                                    ${currentChatId === 'user1' ? 'ì›¹ë””ìì¸, ì‚¬ìš©ìê²½í—˜, ë¯¸ë‹ˆë©€ë¦¬ì¦˜, ì»¤í”¼' : 
                                      currentChatId === 'user2' ? 'React, ë””ìì¸ì‹œìŠ¤í…œ, ì˜¤í”ˆì†ŒìŠ¤, ë§¥ì£¼' : 
                                      'IT, ì»¤í”¼, ë„¤íŠ¸ì›Œí‚¹, ìê¸°ê³„ë°œ'}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    window.parent.postMessage({
                        action: 'openModal',
                        title: `${user.name}ë‹˜ì˜ í”„ë¡œí•„`,
                        content: profileContent,
                        buttons: [
                            {
                                text: 'í™•ì¸'
                            }
                        ]
                    }, '*');
                });
                
                // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
                refreshBtn.addEventListener('click', function() {
                    loadChatContent(currentChatId);
                    
                    window.parent.postMessage({
                        action: 'notification',
                        text: 'ì±„íŒ… ë‚´ìš©ì´ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        type: 'info'
                    }, '*');
                });
                
                // ëŒ€í™” ì €ì¥ ë²„íŠ¼
                saveBtn.addEventListener('click', function() {
                    window.parent.postMessage({
                        action: 'notification',
                        text: 'ëŒ€í™” ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        type: 'success'
                    }, '*');
                });
            }
            
            // ì¼ì • ë©”ì‹œì§€ ì „ì†¡
            function sendScheduleMessage(date, time, location, memo) {
                // ìƒˆ ë©”ì‹œì§€ ìš”ì†Œ ìƒì„± (ì¼ì • ì œì•ˆ)
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message chat-message-sent';
                
                const dateObj = new Date(date + 'T' + time);
                const formattedDate = new Intl.DateTimeFormat('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long',
                    hour: 'numeric',
                    minute: 'numeric',
                    hour12: true
                }).format(dateObj);
                
                const contentElement = document.createElement('div');
                contentElement.className = 'chat-message-content';
                contentElement.innerHTML = `
                    <div style="border-left: 3px solid #0f0; padding-left: 10px; margin: 5px 0;">
                        <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“… ì¼ì • ì œì•ˆ</div>
                        <div>ë‚ ì§œ: ${formattedDate}</div>
                        <div>ì¥ì†Œ: ${location}</div>
                        ${memo ? `<div>ë©”ëª¨: ${memo}</div>` : ''}
                    </div>
                `;
                
                const timeElement = document.createElement('div');
                timeElement.className = 'chat-message-time';
                
                // í˜„ì¬ ì‹œê°„ í¬ë§·íŒ…
                const now = new Date();
                const ampm = now.getHours() < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
                const hours = now.getHours() % 12 || 12;
                const minutes = now.getMinutes().toString().padStart(2, '0');
                timeElement.textContent = `${ampm} ${hours}:${minutes}`;
                
                messageElement.appendChild(contentElement);
                messageElement.appendChild(timeElement);
                
                // ì±„íŒ… ì°½ì— ì¶”ê°€
                chatMessages.appendChild(messageElement);
                
                // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                scrollToBottom();
                
                // ìë™ ì‘ë‹µ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬)
                setTimeout(() => {
                    const responseElement = document.createElement('div');
                    responseElement.className = 'chat-message chat-message-received';
                    
                    const responseContent = document.createElement('div');
                    responseContent.className = 'chat-message-content';
                    responseContent.innerHTML = 'ë„¤, ì¢‹ìŠµë‹ˆë‹¤! í•´ë‹¹ ì¼ì •ìœ¼ë¡œ ëµ™ê² ìŠµë‹ˆë‹¤. ğŸ‘';
                    
                    const responseTime = document.createElement('div');
                    responseTime.className = 'chat-message-time';
                    
                    // ì•½ê°„ ì§€ì—°ëœ ì‹œê°„
                    const responseDate = new Date(now.getTime() + Math.floor(Math.random() * 120000));
                    const responseAmPm = responseDate.getHours() < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
                    const responseHours = responseDate.getHours() % 12 || 12;
                    const responseMinutes = responseDate.getMinutes().toString().padStart(2, '0');
                    responseTime.textContent = `${responseAmPm} ${responseHours}:${responseMinutes}`;
                    
                    responseElement.appendChild(responseContent);
                    responseElement.appendChild(responseTime);
                    
                    chatMessages.appendChild(responseElement);
                    
                    // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
                    scrollToBottom();
                    
                    // ì±„íŒ… ëª©ë¡ ì—…ë°ì´íŠ¸
                    updateChatPreview(currentChatId, 'ë„¤, ì¢‹ìŠµë‹ˆë‹¤! í•´ë‹¹ ì¼ì •ìœ¼ë¡œ ëµ™ê² ìŠµë‹ˆë‹¤. ğŸ‘');
                    
                    // ì¼ì • í™•ì • ë©”ì‹œì§€
                    const infoElement = document.createElement('div');
                    infoElement.className = 'chat-info-message';
                    infoElement.innerHTML = `ğŸ“Œ ${formattedDate}ì— ${location}ì—ì„œ ë§Œë‚¨ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    
                    chatMessages.appendChild(infoElement);
                    scrollToBottom();
                    
                }, Math.random() * 2000 + 1000); // 1-3ì´ˆ ì‚¬ì´ ëœë¤ ì§€ì—°
            }
        });
    </script>
</body>
</html>